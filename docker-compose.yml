version: "3.9"

services:
  jupyter:
    build:
      context: .
      dockerfile: docker/jupyter.Dockerfile
    container_name: aerostream-jupyter
    ports:
      - "8888:8888"
    volumes:
      - ./notebooks:/workspace/notebooks
      - ./data:/workspace/data
      - ./models:/workspace/models
    environment:
      - JUPYTER_ENABLE_LAB=yes

  streamlit:
    build:
      context: .
      dockerfile: docker/streamlit.Dockerfile
    container_name: aerostream-streamlit
    ports:
      - "8501:8501"
    volumes:
      - ./dashboard:/dashboard
      - ./models:/models
    depends_on:
      - jupyter

  airflow:
    build:
      context: .
      dockerfile: docker/airflow.Dockerfile
    container_name: aerostream-airflow
    ports:
      - "8080:8080"
    volumes:
      - ./airflow/dags:/opt/airflow/dags
      - ./data:/opt/airflow/data
      - ./models:/opt/airflow/models
    environment:
      - AIRFLOW__CORE__LOAD_EXAMPLES=False
      - AIRFLOW__CORE__EXECUTOR=SequentialExecutor
